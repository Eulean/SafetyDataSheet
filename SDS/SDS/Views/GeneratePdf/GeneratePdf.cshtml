﻿@using System.Web
@using Microsoft.AspNetCore.Html
@using System.Text.RegularExpressions
@using SDS.Helper
@model SDS.Models.SdsViewModel;


@functions {
    public static HtmlString HtmlRaw(string? content, string defaultValue = "No additional data available.")
    {
        if (string.IsNullOrWhiteSpace(content))
            return new HtmlString(defaultValue);

        var trimmedContent = content.Trim();
        var isEmptyHtml = Regex.IsMatch(trimmedContent,
            @"^<p>\s*<br\s*/?>\s*</p>$",
            RegexOptions.IgnoreCase);

        return new HtmlString(isEmptyHtml ? defaultValue : content);
    }

    public string ConvertToBase64Image(byte[] imageBytes)
    {
        string mimeType = "image/png"; // or "image/jpeg", "image/gif", etc.

        // Convert to Base64 and format as data URL
        return $"data:{mimeType};base64,{Convert.ToBase64String(imageBytes)}";
    }

    public static HtmlString AddOneImage(HeaderHImage imgBinary)
    {
        if (imgBinary != null)
        {
            string content = $@"<img
                src=""data:image/{imgBinary.ContentType};base64,{imgBinary.ImageData}""
                alt=""{imgBinary.ContentID}""
                class=""imgStyle""
            />";
            return new HtmlString(content);
        }
        return new HtmlString(string.Empty);
    }

    public static HtmlString PrintOneLine(double no, string title, string data, bool important = false, string imageTag = null, Dictionary<string, List<HeaderHImage>> imagesByContentID = null)
    {
        string content = $@"<tr class=""header-row"">
            <td class=""section-number first-col"">{no}</td>
            <td colspan=""2"">{title}</td>
        </tr>";

        string nullText = important 
            ? "No additional data available, but it must be considered that this product may be dangerous for the environment." 
            : "No additional data available.";

        if (string.IsNullOrEmpty(data))
        {
            content += $@"<tr class=""content-row"">
                <td style=""border-right-color: white !important;"" class=""first-col""></td>
                <td colspan=""2"">{nullText}</td>
            </tr>";
        }
        else
        {
            if (!string.IsNullOrEmpty(imageTag) && imagesByContentID != null && imagesByContentID.ContainsKey(imageTag))
            {
                var imgBinary = imagesByContentID[imageTag];
                if (imgBinary != null && imgBinary.Count > 0 && imgBinary[0] != null)
                {
                    data += AddOneImage(imgBinary[0]).Value;
                }
            }

            content += $@"<tr class=""content-row"">
                <td style=""border-right-color: white !important;"" class=""first-col""></td>
                <td colspan=""2"">{data}</td>
            </tr>";
        }

        return new HtmlString(content);
    }

    public static HtmlString PrintSideBySide(string title, string data, bool bgBlue = false)
    {
        string bgClass = bgBlue ? "bgBlue" : "";
        string borderColor = bgBlue ? "#002060" : "white";

        string content = $@"<td class=""{bgClass} first-col"" style=""border-right-color: {borderColor} !important;""></td>
            <td class=""{bgClass} second-col""><b>{title}</b></td>";

        if (string.IsNullOrEmpty(data))
        {
            content += @"<td>No additional data available.</td>";
        }
        else
        {
            content += $@"<td>{data}</td>";
        }

        string element = $@"<tr class=""content-row"">{content}</tr>";

        return new HtmlString(element);
    }
}

<style>
    /* p{ */
    /*     margin:0 !important; */
    /*     padding: 5px !important; */
    /* } */

    .header, .footer {
        display:none;
    }

    .header-row 
    {
        background-color: #00285b;
        color: white;
        font-weight: bold;
    }

    .header-row .header-row-child
    {
        background-color: white;
        color: black;
    }

     .sec-header-row  {
        background-color: #00285b !important;
        font-weight: bold;
        color: white;
        padding: 8px;

     }

    .section-number 
    {
        width: 65px;
    }

    .fw-bold 
    {
        font-weight: bold;
    }

    .fst-italic 
    {
        font-style: italic;
    }

    .table 
    {
        border: 1px solid #000;
    }

    tbody, td, tfoot, th, thead 
    {
        border: 1px solid gray !important;
        padding: 5px !important;
        text-justify: auto !important;
    }

    .noRightB
    {
        border-right: 0px;
    }

    .four-fw-bold {
        background-color: #00285b !important;
        color: white; /* Add for contrast */
    }

    .safety-data-sheet 
    {
        font-weight: bolder;
        border: 2px solid #000000;
        font-size: 2rem;
        font-family: Georgia, serif;
        background-color: #fcc73b;
        display: inline-block;
        padding: 1% 20% !important;
        margin: 0;
    }

    body {
        font-family: Arial, sans-serif;
        text-align: justify;
    }

    .main-title {
        font-weight: bold;
        font-size: 16px;
        margin-bottom: 5px;
        text-decoration: underline;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        border: 1px solid #000;
    }

    .header-row {
        background-color: #002060;
        color: white;
        font-weight: bold;
    }

        .header-row td {
            padding: 5px 10px;
            border: 1px solid #000;
        }

    .content-row td {
        padding: 5px 10px;
        border: 1px solid #000;
        background-color: white;
    }

    .section-number {
        font-weight: bold;
    }

    .category-cell {
        width: 35%;
        font-weight: bold;
    }

    .bgBlue {
        background-color: #002060 !important;
        color: white;
    }

    .first-col {
        width: 35px;
    }

    .second-col {
        width: 30%;
    }

    .imgStyle {
        width: 105px;
        height: 105px;
        object-fit: cover;
    }
</style>

<div class="text-center m-4">
    <p class="safety-data-sheet">Safety Data Sheet</p>
</div>
<div>
    <!-- Section 1 Table -->
    <h5 class="text-decoration-underline">01. IDENTIFICATION OF THE SUBSTANCE/PREPARATION & THE COMPANY/UNDERTAKING</h5>
    <table class="table table-bordered mb-3">
        <tbody>
            <!-- Section 1.1 -->
            <tr class="header-row">
                <th class="section-number">1.1</th>
                <th colspan="6">Product Identifier</th>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">Product Name</th>
                <td colspan="5">@HtmlRaw(Model.ProductName)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">Biological Definition</th>
                <td colspan="5" class="fst-italic">@HtmlRaw(Model.BiologicalDefinition)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">INCI Name</th>
                <td colspan="5" class="fst-italic">@HtmlRaw(Model.InciName)</td>
            </tr>
            <tr>
                <th class="fw-bold">CAS #</th>
                <td colspan="2">@HtmlRaw(Model.CasNumber)</td>
                <th class="fw-bold noRightB">FEMA #</th>
                <td colspan="1">@HtmlRaw(Model.FemaNumber)</td>
                <th class="fw-bold noRightB">EINECS #</th>
                <td colspan="1">@HtmlRaw(Model.EinecsNumber)</td>
            </tr>

            <!-- Section 1.2 -->
            <tr class="header-row">
                <th class="section-number">1.2</th>
                <th colspan="6">Relative identified uses of the substance or mixture and uses advised against</th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.IdentifiedUses)</td>
            </tr>

            <!-- Section 1.3 -->
            <tr class="header-row">
                <th class="section-number">1.3</th>
                <th colspan="6">Details of the supplier of the safety data sheet</th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.SupplierDetails)</td>
            </tr>

            <!-- Section 1.4 -->
            <tr class="header-row">
                <th class="section-number">1.4</th>
                <th colspan="2">Emergency Tel. No.</th>
                <td colspan="4" class="header-row-child">@HtmlRaw(Model.EmergencyPhone)</td>
            </tr>
        </tbody>
    </table>

    <!-- Section 2 Table -->
    <h5 class="text-decoration-underline">02. HAZARDS IDENTIFICATION</h5>
    <table class="table table-bordered mb-3">
        <tbody>
            <!-- Section 2.1 -->
            <tr class="header-row">
                <th class="section-number">2.1</th>
                <th colspan="6">Classification of the substance or mixture</th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">
                    @HtmlRaw(Model.ClassificationContent)
                </td>
            </tr>

            <!-- Section 2.2 -->
            <tr class="header-row">
                <th class="section-number">2.2</th>
                <th colspan="6">Label Elements</th>
            </tr>
            <tr class="header-row">
                <th colspan="7">@HtmlRaw(Model.LabelContent)</th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">
                    @if (Model.ImagesByContentID.TryGetValue(ImageIds.labelImage, out var images))
                    {
                        <div style="display: flex; flex-direction: row; gap: 1rem;">
                            @foreach (var image in images)
                            {
                                <div style="display: flex; flex-direction: column; align-items: center;">
                                    <img src="@ConvertToBase64Image(image.ImageData)"
                                    alt="@image.ImageName"
                                    style="width: 60px; height: 60px;">
                                    <span style="font-size: 0.7rem; color: #6c757d; margin-top: 0.25rem;">@image.ImageName</span>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <p>No additional data available.</p>
                    }
                </td>
            </tr>
            <tr class="header-row">
                <th colspan="2">Signal Word</th>
                <td colspan="5" class="header-row-child">@HtmlRaw(Model.SignalWord)</td>
            </tr>
            <tr class="header-row">
                <th colspan="2">Contains</th>
                <td colspan="5" class="header-row-child">@HtmlRaw(Model.ContainsInfo)</td>
            </tr>

            <tr class="header-row">
                <th colspan="7">Hazard Statements</th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.HazardStatements)</td>
            </tr>

            <!-- Section 2.3 -->
            <tr class="header-row">
                <th class="section-number">2.3</th>
                <th colspan="6">Other Hazards</th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6" class="text-justify">@Html.Raw(Model.OtherHazards)</td>
            </tr>
        </tbody>
    </table>

    <!-- Section 3 Table -->
    <h5 class="text-decoration-underline">03. COMPOSITION/INFORMATION ON INGREDIENTS</h5>
    <table class="table table-bordered mb-3">
        <tbody>
            <!-- Section 3.1 -->
            <tr class="header-row">
                <th class="section-number">3.1</th>
                <th colspan="6">
                    Substances
                </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">
                    @HtmlRaw(Model.ClassificationContent)
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Section 4 -->
    <h5 class="text-decoration-underline ">04. FIRST AID MEASURES</h5>
    <table class="table table-bordered">
        <tbody>
            <tr class="header-row">
                <th class="section-number">4.1</th>
                <th colspan="6"> Description of first aid measures </th>
            </tr>
            <tr>
                <th colspan="2" class="four-fw-bold">Inhalation</th>
                <td colspan="5"> @HtmlRaw(Model.InhalationFirstAid)</td>
            </tr>
            <tr>
                <th colspan="2" class="four-fw-bold"> Ingestion </th>
                <td colspan="5">@HtmlRaw(Model.IngestionFirstAid)</td>
            </tr>
            <tr>
                <th colspan="2" class="four-fw-bold"> Skin Contact </th>
                <td colspan="5">@HtmlRaw(Model.SkinContactFirstAid)</td>
            </tr>
            <tr>
                <th colspan="2" class="four-fw-bold">Eye Contact</th>
                <td colspan="5">@HtmlRaw(Model.EyeContactFirstAid)</td>
            </tr>

            <tr class="header-row">
                <th class="section-number">4.2</th>
                <th colspan="6">
                    Most important symptoms and effects, both acute and delayed
                </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">
                    @HtmlRaw(Model.SymptomsEffects)
                </td>
            </tr>

            <tr class="header-row">
                <th class="section-number">4.3</th>
                <th colspan="6">
                    Most important symptoms and effects, both acute and delayed
                </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">
                    @HtmlRaw(Model.MedicalAttention)
                </td>
            </tr>
        </tbody>        
    </table>

    <!-- Section 5 Table -->
    <h5 class="text-decoration-underline ">05. FIRE-FIGHTING MEASURES</h5>
    <table class="table table-bordered mb-3">

        <tbody>
            <!-- 5.1 -->
            <tr class="header-row">
                <th class="section-number">5.1</th>
                <th colspan="6"> Extinguishing Media </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.ExtinguishingMediaContent)</td>
            </tr>

            <!-- 5.2 -->
            <tr class="header-row">
                <th class="section-number">5.2</th>
                <th colspan="6"> Special hazards arising from the product </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.SpecialHazardsContent)</td>
            </tr>

            <!-- 5.3 -->
            <tr class="header-row">
                <th class="section-number">5.3</th>
                <th colspan="6"> Advice for firefighters </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">
                    @HtmlRaw(Model.FirefighterAdviceContent)
                </td>
            </tr>
        </tbody>
    </table>

    <!---Section 6 Table  -->
    <h5 class="text-decoration-underline ">06. ACCIDENTAL RELEASE MEASURES</h5>
    <table class="table table-bordered">
        <tbody>
            <!-- 6.1 -->
            <tr class="header-row">
                <th class="section-number">6.1</th>
                <th colspan="6"> Personal precautions, protective equipment and emergency procedures </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.PersonalPrecautions)</td>
            </tr>

            <!-- 6.2 -->
            <tr class="header-row">
                <th class="section-number">6.2</th>
                <th colspan="6"> Environmental Precautions </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.EnvironmentalPrecautions)</td>
            </tr>
            <!-- 6.3 -->
            <tr class="header-row">
                <th class="section-number">6.3</th>
                <th colspan="6"> Methods and material for containment and cleaning up. </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.ContainmentMethods)</td>
            </tr>

            <!-- 6.4 -->
            <tr class="header-row">
                <th class="section-number">6.4</th>
                <th colspan="6"> Reference to other sections  </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.SectionReferences)</td>
            </tr>
        </tbody>
    </table>

    <!---Section 7 Table  -->
    <h5 class="text-decoration-underline ">07. HANDLING AND STORAGE</h5>
    <table class="table table-bordered">
        <tbody>
            <!-- 7.1 -->
            <tr class="header-row">
                <th class="section-number">7.1</th>
                <th colspan="6"> Precautions for safe handling  </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.SafeHandlingPrecautions)</td>
            </tr>

            <!-- 7.2 -->
            <tr class="header-row">
                <th class="section-number">7.2</th>
                <th colspan="6"> Conditions for safe storage, including any incompatibilities  </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.SafeStorageConditions)</td>
            </tr>
            <!-- 7.3 -->
            <tr class="header-row">
                <th class="section-number">7.3</th>
                <th colspan="6"> Specific end use(s)   </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.SpecificEndUses)</td>
            </tr>

        </tbody>
    </table>

    <!---Section 8 Table  -->
    <h5 class="text-decoration-underline">08. EXPOSURE CONTROLS/PERSONAL PROTECTION</h5>
    <table class="table table-bordered">
        <tr class="header-row">
            <th class="section-number">8.1</th>
            <th colspan="6">Control Parameters</th>
        </tr>
        <tr>
            <td style="border-right-color: white !important;"></td>
            <td colspan="6">No additional data available.</td>
        </tr>

        <tr class="header-row">
            <th class="section-number">8.2</th>
            <th colspan="6">Exposure Controls</th>
        </tr>
        <tr>
            <th colspan="7">Protective Equipment</th>
        </tr>
        <tr>
            <td style="border-right-color: white !important;"></td>
            <td colspan="6">
                @if (Model.ProtectiveEquipment.TryGetValue(ImageIds.protectiveEquipmentImage, out var ProtectiveEquipmentImages))
                {
                    <div style="display: flex; flex-direction: row; gap: 1rem;">
                        @foreach (var image in images)
                        {
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <img src="@ConvertToBase64Image(image.ImageData)"
                                alt="@image.ImageName"
                                style="width: 60px; height: 60px;">
                                <span style="font-size: 0.7rem; color: #6c757d; margin-top: 0.25rem;">@image.ImageName</span>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p>No additional data available.</p>
                }
            </td>
        </tr>
        <tr>
            <td colspan="2" class="fw-bold">Process Conditions</td>
            <td colspan="5">@HtmlRaw(Model.ProcessConditions)</td>
        </tr>
        <tr>
            <td colspan="2" class="fw-bold">Engineering Measures</td>
            <td colspan="5">@HtmlRaw(Model.EngineeringMeasures)</td>
        </tr>
        <tr>
            <td colspan="2" class="fw-bold">Respiratory Equipment</td>
            <td colspan="5">@HtmlRaw(Model.RespiratoryEquipment)</td>
        </tr>
        <tr>
            <td colspan="2" class="fw-bold">Hand Protection</td>
            <td colspan="5">@HtmlRaw(Model.HandProtection)</td>
        </tr>
        <tr>
            <td colspan="2" class="fw-bold">Eye Protection</td>
            <td colspan="5">@HtmlRaw(Model.EyeProtection)</td>
        </tr>
        <tr>
            <td colspan="2" class="fw-bold">Other Protection</td>
            <td colspan="5">@HtmlRaw(Model.OtherProtection)</td>
        </tr>
        <tr>
            <td colspan="2" class="fw-bold">Hygiene Measures</td>
            <td colspan="5">@HtmlRaw(Model.HygieneMeasures)</td>
        </tr>
        <tr>
            <td colspan="2" class="fw-bold">Personal Protection</td>
            <td colspan="5">@HtmlRaw(Model.PersonalProtection)</td>
        </tr>
        <tr>
            <td colspan="2" class="fw-bold">Skin Protection</td>
            <td colspan="5">@HtmlRaw(Model.SkinProtection)</td>
        </tr>
        <tr>
            <td colspan="2" class="fw-bold">Environmental Exposure Control</td>
            <td colspan="5">@HtmlRaw(Model.EnvironmentalExposure)</td>
        </tr>
    </table>

    <!-- Section 9 Table -->
    <h5 class="text-decoration-underline">09. PHYSICAL AND CHEMICAL PROPERTIES</h5>
    <table class="table table-bordered mb-3">
        <tbody>
            <!-- Section 9.1 -->
            <tr class="header-row">
                <th class="section-number">9.1</th>
                <th colspan="6">Information on basic physical and chemical properties</th>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">
                    Appearance
                </th>
                <td colspan="5">@HtmlRaw(Model.Appearance)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">
                    Colour
                </th>
                <td colspan="5">@HtmlRaw(Model.Colour)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">
                    Odour
                </th>
                <td colspan="5">@HtmlRaw(Model.Odour)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">
                    Relative Density
                </th>
                <td colspan="5">@HtmlRaw(Model.RelativeDensity)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">
                    Flash Point (°C)
                </th>
                <td colspan="5">@HtmlRaw(Model.FlashPoint)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">
                    Melting Point (°C)
                </th>
                <td colspan="5">@HtmlRaw(Model.MeltingPoint)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">
                    Refractive Index
                </th>
                <td colspan="5">@HtmlRaw(Model.RefractiveIndex)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">
                    Boiling Point (°C)
                </th>
                <td colspan="5">@HtmlRaw(Model.BoilingPoint)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">
                    Vapour Pressure
                </th>
                <td colspan="5">@HtmlRaw(Model.VapourPressure)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">
                    Solubility in Water @@ 20°C
                </th>
                <td colspan="5">@HtmlRaw(Model.SolubilityInWater)</td>
            </tr>
            <tr>
                <th colspan="2" class="fw-bold">
                    Auto-ignition temperature (°C)
                </th>
                <td colspan="5">@HtmlRaw(Model.AutoIgnitionTemp)</td>
            </tr>

            <!-- Section 9.2 -->
            <tr class="header-row">
                <th class="section-number">9.2</th>
                <th colspan="6">Other information</th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.OtherChemicalInfo)</td>
            </tr>
        </tbody>
    </table>

    <!-- Section 10 Table -->
    <h5 class="text-decoration-underline">10. STABILITY AND REACTIVITY</h5>
    <table class="table table-bordered mb-3 ">
        <tbody>
            <!-- Section 10.1 -->
            <tr class="header-row">
                <th class="section-number">10.1</th>
                <th colspan="6">
                    Reactivity
                </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.ReactivityInfo)</td>
            </tr>

            <!-- Section 10.2 -->
            <tr class="header-row">
                <th class="section-number">10.2</th>
                <th colspan="6">
                    Chemical stability
                </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.ChemicalStability)</td>
            </tr>

            <!-- Section 10.3 -->
            <tr class="header-row">
                <th class="section-number">10.3</th>
                <th colspan="6">
                    Possible hazardous reactions
                </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.HazardousReactions)</td>
            </tr>

            <!-- Section 10.4 -->
            <tr class="header-row">
                <th class="section-number">10.4</th>
                <th colspan="6">
                    Conditions to Avoid
                </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.ConditionsToAvoid)</td>
            </tr>

            <!-- Section 10.5 -->
            <tr class="header-row">
                <th class="section-number">10.5</th>
                <th colspan="6">
                    Incompatible materials
                </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.IncompatibleMaterials)</td>
            </tr>

            <!-- Section 10.6 -->
            <tr class="header-row">
                <th class="section-number">10.6</th>
                <th colspan="6">
                    Hazardous Decomposition Products
                </th>
            </tr>
            <tr>
                <td style="border-right-color: white !important;"></td>
                <td colspan="6">@HtmlRaw(Model.HazardousDecomposition)</td>
            </tr>
        </tbody>
    </table>
</div>
<div id="last-section">
    <div id="section-10" class="mt-3">
        <h2 class="main-title">10. STABILITY AND REACTIVITY</h2>
        <table id="section-10-data" class="mx-3">
            @Html.Raw(PrintOneLine(10.1, "Reactivity", Model.ReactivityInfo))
            @Html.Raw(PrintOneLine(10.2, "Chemical stability", Model.ChemicalStability))
            @Html.Raw(PrintOneLine(10.3, "Possible hazardous reactions", Model.HazardousReactions))
            @Html.Raw(PrintOneLine(10.4, "Conditions to Avoid", Model.ConditionsToAvoid))
            @Html.Raw(PrintOneLine(10.5, "Incompatible materials", Model.IncompatibleMaterials))
            @Html.Raw(PrintOneLine(10.6, "Hazardous Decomposition Products", Model.HazardousDecomposition))
        </table>
    </div>

    <div id="section-11" class="mt-3">
        <h2 class="main-title">11. TOXICOLOGICAL INFORMATION</h2>
        <table id="section-11-data" class="mx-3">
            <tr class="header-row">
                <td class="section-number first-col">11.1</td>
                <td colspan="2">Information on toxicological effects</td>
            </tr>
            @Html.Raw(PrintSideBySide("Acute Toxicity", Model.AcuteToxicity))
            @Html.Raw(PrintSideBySide("Skin corrosion/irritation", Model.SkinCorrosion))
            @Html.Raw(PrintSideBySide("Eye Damage", Model.EyeDamage))
            @Html.Raw(PrintSideBySide("Respiratory or skin sensitisation", Model.SkinSensitization))
            @Html.Raw(PrintSideBySide("Germ Cell Mutagenicity", Model.GermCell))
            @Html.Raw(PrintSideBySide("Carcinogenicity", Model.Carcinogenicity))
            @Html.Raw(PrintSideBySide("Reproductive toxicity", Model.ReproductiveToxicity))
            @Html.Raw(PrintSideBySide("STOT-single exposure", Model.SingleExposure))
            @Html.Raw(PrintSideBySide("STOT-repeated exposure", Model.RepeatedExposure))
            @Html.Raw(PrintSideBySide("Aspiration hazard", Model.AspirationHazard))
            @Html.Raw(PrintSideBySide("Photo-toxicity", Model.PhotoToxicity))
            @Html.Raw(PrintSideBySide("Other Information", Model.OtherInfo))
        </table>
    </div>

    <div id="section-12" class="mt-3">
        <h2 class="main-title">12. ECOLOGICAL INFORMATION</h2>
        <table id="section-12-data" class="mx-3">
            @Html.Raw(PrintOneLine(12.1, "Toxicity", Model.EcoToxicity, true))
            @Html.Raw(PrintOneLine(12.2, "Persistence & degradability", Model.PersistenceDegradability))
            @Html.Raw(PrintOneLine(12.3, "Bioaccumulation Potential", Model.BioaccumulationPotential))
            @Html.Raw(PrintOneLine(12.4, "Mobility in soil", Model.SoilMobility))
            @Html.Raw(PrintOneLine(12.5, "Results of PBT and vPvB Assessment", Model.PbtAssessment))
            @Html.Raw(PrintOneLine(12.6, "Other adverse effects", Model.OtherAdverseEffects))
        </table>
    </div>

    <div id="section-13" class="mt-3">
        <h2 class="main-title">13. DISPOSAL CONSIDERATIONS</h2>
        <table id="section-13-data" class="mx-3">
            @Html.Raw(PrintOneLine(13.1, "Waste treatment methods", Model.WasteTreatmentMethod))
        </table>
    </div>

    <div id="section-14" class="mt-3">
        <h2 class="main-title">14. TRANSPORT INFORMATION</h2>
        <table id="section-14-data" class="mx-3">
            <tr class="header-row">
                <td colspan="1" class="section-number first-col">14.1</td>
                <td colspan="2">UN number</td>
            </tr>
            @Html.Raw(PrintSideBySide("UN No. Road", Model.UnRoad, true))
            @Html.Raw(PrintSideBySide("UN No. SEA", Model.UnSea, true))
            @Html.Raw(PrintSideBySide("UN No. AIR", Model.UnAir, true))
            @Html.Raw(PrintOneLine(14.2, "UN proper shipping name", Model.ShippingName))
            @Html.Raw(PrintOneLine(14.3, "Transport hazard class(es)", Model.HazardClass, false, "hazardClass", Model.ImagesByContentID))
            @Html.Raw(PrintOneLine(14.4, "Packing group", Model.PackingGroup))
            @Html.Raw(PrintOneLine(14.5, "Environmental hazards", Model.EnvironmentalHazards, false, "environmentalHazards", Model.ImagesByContentID))
            @Html.Raw(PrintOneLine(14.6, "Special precautions for user", Model.SpecialPrecautions))
            @Html.Raw(PrintOneLine(14.6, "Bulk Transport", Model.BulkTranprt)) <!-- TODO: Need title for this line -->
            @Html.Raw(PrintOneLine(14.7, "Transport in bulk according to Annex II of MARPOL73/78 and the IBC code", Model.IbcCode))
        </table>
    </div>

    <div id="section-15" class="mt-3">
        <h2 class="main-title">15. REGULATORY INFORMATION</h2>
        <table id="section-15-data" class="mx-3">
            @Html.Raw(PrintOneLine(15.1, "Safety, health and environmental regulations/legislation specific for the substance or mixture", Model.SafetyRegulations))
            @Html.Raw(PrintOneLine(15.2, "Chemical safety assessment", Model.ChemicalSafetyAssessment))
        </table>
    </div>

    <div id="section-16" class="mt-3">
        <h2 class="main-title">16. OTHER INFORMATION</h2>
        <table id="section-16-data" class="mx-3">
            @Html.Raw(PrintSideBySide("Hazard and/or Precautionary Statements in Full", Model.PrecautionaryStatements, true))
            @Html.Raw(PrintSideBySide("Other Information", Model.OtherInformation, true))
            @Html.Raw(PrintSideBySide("Revision Date", Model.RevisionDate.ToString(), true))
            @Html.Raw(PrintSideBySide("Reason for revision", Model.RevisionReason, true))
            @Html.Raw(PrintSideBySide("Rev No/Repl, SDS Generated", Model.RevNo, true))
        </table>
    </div>
</div>

@section Scripts {
    <script>
        function getValueBetweenTags(htmlString, tag) {
          const regex = new RegExp(`<${tag}[^>]*>(.*?)<\\/${tag}>`, 'i');
          const match = htmlString.match(regex);
          return match ? match[1] : null;
        }

        function parseBAndPTags(key, value, htmlString) {
            const tagRegex = new RegExp(`<(${key}|${value})[^>]*>(.*?)<\\/\\1>`, "gi");
            const matches = [...htmlString.matchAll(tagRegex)];

          const resultMap = new Map();
          let currentKey = null;

          for (const match of matches) {
            const tag = match[1].toLowerCase();
            const content = match[2];

            if (tag === key) {
              currentKey = content;
              resultMap.set(currentKey, null);
            } else if (tag === value && currentKey) {
              resultMap.set(currentKey, content);
              currentKey = null;
            }
          }

          return resultMap;
        }

        function loopDoubleSection(data, bgBlue = false){
            let headerTag = 'b'
            let bodyTag = 'p'
            let content = ''
            if(data == null || data.length == 0){
                content += `<tr class="content-row"><td></td><td>No additional data available.</td></tr>`
            }else{
                let resultMap = parseBAndPTags(headerTag, bodyTag, data);
                for (const [title, value] of resultMap.entries()) {
                    content += printSideBySide(title, value, bgBlue)};
                }
            }
            return content;
        }
    </script>
}
